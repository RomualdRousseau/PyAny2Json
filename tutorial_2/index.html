<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Tutorial 2 - Data extraction with a complex semi-structured layout - PyAny2Json Documents</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">PyAny2Json Documents</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#tutorial-2-data-extraction-with-a-complex-semi-structured-layout" class="nav-link">Tutorial 2 - Data extraction with a complex semi-structured layout</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#setup-pyany2json" class="nav-link">Setup PyAny2Json</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#minimal-code" class="nav-link">Minimal code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#load-base-model" class="nav-link">Load base model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#conclusion" class="nav-link">Conclusion</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="tutorial-2-data-extraction-with-a-complex-semi-structured-layout">Tutorial 2 - Data extraction with a complex semi-structured layout</h1>
<p><a href="https://github.com/RomualdRousseau/PyAny2Json">View source on GitHub</a>.</p>
<p>This tutorial will demonstrate how to use <a href="https://github.com/RomualdRousseau/PyAny2Json">Any2Json</a> to extract data from
one Excel spreadsheet. To demonstrate the usage of this framework, we will load a document with a somewhat complex
layout, as seen here:</p>
<p><img alt="document with multiple tables" src="../images/tutorial2_data.png" /></p>
<h2 id="setup-pyany2json">Setup PyAny2Json</h2>
<p>Before to use the package, you need to download the jars in your project. Run the following command line at the root of
your python project:</p>
<pre><code class="language-bash">python pyany2json/setup.py
</code></pre>
<h3 id="import-the-package">Import the package:</h3>
<pre><code class="language-python">import pyany2json
</code></pre>
<h2 id="minimal-code">Minimal code</h2>
<p>The minimal code to load a document is as follow:</p>
<pre><code class="language-python">with pyany2json.load(file_path, encoding=&quot;UTF-8&quot;) as doc:
    for sheet in doc.sheets():
        table = sheet.getTable()
        if table.isPresent():
            table = table.get()
            doSomethingWithHeaders(table.headers())
            doSomethingWithRows(table.rows())
</code></pre>
<p>The encoding ("UTF-8" here) is used if the encoding could not be detected when loading the document.</p>
<h2 id="load-base-model">Load base model</h2>
<p>To parse a document, any2Json needs a model that will contains the parameters required to the parsing. Instead to start
from an empty Model (See <a href="../tutorial_10/">Tutorial 10</a>), we will start from an existing one and we will adapt it for our
document. You can find a list and details of all models <a href="https://github.com/RomualdRousseau/Any2Json-Models/">here</a>.</p>
<p>The base model, we will use, is "sales-english" that has been trained on 200+ english documents containing distributor
data and with a large range of different layouts.</p>
<p>The base model already recognize some entities such as DATE and NUMBER. We will setup the model to add one new entity
PRODUCTNAME and we will configure a layex to extract the different elements of the documents. You can find more details
about layex.</p>
<pre><code class="language-python">REPO_BASE_URL = &quot;https://raw.githubusercontent.com/RomualdRousseau/Any2Json-Models/main&quot;
MODEL_NAME = &quot;sales-english&quot;
FILE_PATH = &quot;data/document with multiple tables.xlsx&quot;
FILE_ENCODING = &quot;UTF-8&quot;


builder = pyany2json.model_from_uri(f&quot;{REPO_BASE_URL}/{MODEL_NAME}/{MODEL_NAME}.json&quot;)

entities = [v for v in builder.getEntityList() if v != &quot;PACKAGE&quot;]
entities.append(&quot;PRODUCTNAME&quot;)

patterns = {k: v for (k, v) in builder.getPatternMap().items() if v != &quot;PACKAGE&quot;}
patterns[&quot;\\D+\\dml&quot;] = &quot;PRODUCTNAME&quot;

parser = pyany2json.LayexTableParser(
    [&quot;(v.$)+&quot;], [&quot;(()(S+$))(()([/^TOTAL/|v].+$)())+(/TOTAL/.+$)&quot;]
)

model = (
    builder.setEntityList(entities)
    .setPatternMap(patterns)
    .setTableParser(parser)
    .build()
)
</code></pre>
<h3 id="load-the-document">Load the document</h3>
<p>We load the document by creating a document instance with the model and options to parse the document. The hint
"pyany2json.INTELLI_LAYOUT" will tell the document instance that the document has a complex layout. The recipe
"sheet.setCapillarityThreshold(0)" will tell the parser engine to extract the features as <strong><em>small</em></strong> as possible. And finally we want the tag case to be in snake case notation:</p>
<pre><code class="language-python">with pyany2json.load(
    FILE_PATH,
    encoding=FILE_ENCODING,
    model=model,
    hints=[pyany2json.INTELLI_LAYOUT],
    recipe=[&quot;sheet.setCapillarityThreshold(0)&quot;],
    tag_case=&quot;SNAKE&quot;
) as doc:
    ...
</code></pre>
<h3 id="output-the-tabular-result">Output the tabular result</h3>
<p>Finally, we iterate over the sheets, rows and cells and outpout the data on the console:</p>
<pre><code class="language-python">    for sheet in doc.sheets():
        table = sheet.getTable()
        if table.isPresent():
            table = table.get()
            for header in table.headers():
                print(header.getTag().getValue(), end=&quot; &quot;)
            print()
            for row in table.rows():
                for cell in row.cells():
                    print(cell.getValue(), end=&quot; &quot;)
                print()
</code></pre>
<pre><code class="language-bash">a_document_very_important date product_name invoice_date client quantity amount 
A document very important 2023-02-01 Product 1ml 2023-02-01 AAA 1 100 
A document very important 2023-02-01 Product 1ml 2023-02-01 BBB 1 100 
A document very important 2023-02-01 Product 1ml 2023-02-01 BBB 3 300 
A document very important 2023-02-01 Product 1ml 2023-02-01 AAA 1 100 
A document very important 2023-02-01 Product 2ml 2023-02-01 AAA 1 100 
A document very important 2023-02-01 Product 2ml 2023-02-01 BBB 2 200 
A document very important 2023-02-01 Product 2ml 2023-02-01 CCC 4 400 
A document very important 2023-02-01 Product 2ml 2023-02-01 DDD 1 100 
A document very important 2023-02-01 Product 3ml 2023-02-01 AAA 1 100 
A document very important 2023-02-01 Product 3ml 2023-02-01 CCC 1 100 
A document very important 2023-02-01 Product 3ml 2023-02-01 AAA 1 100 
A document very important 2023-02-01 Product 3ml 2023-02-01 DDD 1 100 
</code></pre>
<p>On this output, we print out the graph of the document built during the parsing and we can see clearly the relation
between the elements of the spreadsheet and how there are structured in tabular form.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Congratulations! You have loaded documents using Any2Json.</p>
<p>For more examples of using Any2Json, check out the <a href="../">tutorials</a>.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
